<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥å…»é£é™©è¯„ä¼°è®¡ç®—å™¨</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: "Microsoft YaHei", sans-serif; 
            padding: 15px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 { 
            color: #2c80b9; 
            text-align: center; 
            margin-bottom: 20px;
        }
        .section { 
            margin-bottom: 25px; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 8px;
        }
        .section-title { 
            color: #2c80b9; 
            margin-bottom: 10px; 
            font-weight: bold;
        }
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin: 8px 0; 
            border: 1px solid #ddd; 
            border-radius: 5px;
        }
        button { 
            background: #2c80b9; 
            color: white; 
            border: none; 
            padding: 12px; 
            width: 100%; 
            border-radius: 5px; 
            font-size: 16px; 
            margin: 10px 0;
            cursor: pointer;
        }
        button:hover { background: #1e6ea1; }
        .result { 
            background: #e8f4fc; 
            padding: 15px; 
            border-radius: 8px; 
            margin-top: 20px; 
            border-left: 4px solid #2c80b9;
        }
        .score-display { 
            font-size: 24px; 
            font-weight: bold; 
            color: #d9534f; 
            text-align: center;
            margin: 10px 0;
        }
        .tips { 
            background: #fff3cd; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
            border: 1px solid #ffeaa7;
        }
        .input-group { 
            display: flex; 
            gap: 10px; 
            margin: 10px 0;
        }
        .input-group input { flex: 1; }
        .percent { color: #d9534f; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“± è¥å…»é£é™©å¿«é€Ÿè¯„ä¼°è®¡ç®—å™¨</h2>
        
        <!-- æ‚£è€…ä¿¡æ¯ -->
        <div class="section">
            <div class="section-title">æ‚£è€…ä¿¡æ¯</div>
            <input type="text" id="patientName" placeholder="æ‚£è€…å§“å">
            <input type="text" id="patientID" placeholder="ç—…å†å·">
        </div>
        
        <!-- ä½“é‡å˜åŒ– -->
        <div class="section">
            <div class="section-title">1. ä½“é‡å˜åŒ–ï¼ˆkgï¼‰</div>
            <div class="input-group">
                <input type="number" id="currentWeight" placeholder="å½“å‰ä½“é‡" step="0.1">
                <input type="number" id="height" placeholder="èº«é«˜ï¼ˆcmï¼‰" step="0.1">
            </div>
            <div>å†å²ä½“é‡ï¼ˆè‹¥ä¸çŸ¥é“å¯ç•™ç©ºï¼‰</div>
            <input type="number" id="weight1m" placeholder="1ä¸ªæœˆå‰ä½“é‡" step="0.1">
            <input type="number" id="weight2m" placeholder="2ä¸ªæœˆå‰ä½“é‡" step="0.1">
            <input type="number" id="weight3m" placeholder="3ä¸ªæœˆå‰ä½“é‡" step="0.1">
            <div id="weightLossDisplay" class="tips"></div>
        </div>
        
        <!-- è¿›é£Ÿæƒ…å†µ -->
        <div class="section">
            <div class="section-title">2. è¿›é£Ÿæƒ…å†µ</div>
            <select id="foodIntake">
                <option value="100">æ­£å¸¸åƒé¥­ï¼ˆ75-100%ï¼‰</option>
                <option value="65">åƒå¾—å°‘ä¸€äº›ï¼ˆ50-75%ï¼‰</option>
                <option value="37.5">åƒå¾—å¾ˆå°‘ï¼ˆ25-50%ï¼‰</option>
                <option value="12.5">å‡ ä¹æ²¡åƒï¼ˆ0-25%ï¼‰</option>
            </select>
        </div>
        
        <!-- èº«ä½“çŠ¶å†µ -->
        <div class="section">
            <div class="section-title">3. èº«ä½“çŠ¶å†µ</div>
            <select id="physicalState">
                <option value="0">ç²¾ç¥ã€åŠ›æ°”æ­£å¸¸</option>
                <option value="1">æœ‰ç‚¹ä¹åŠ›ï¼Œé£Ÿæ¬²ä¸€èˆ¬</option>
                <option value="2">æ˜æ˜¾æ¶ˆç˜¦ï¼Œæ²¡ç²¾ç¥æ²¡åŠ›æ°”</option>
            </select>
        </div>
        
        <!-- ç–¾ç—…ç±»å‹ -->
        <div class="section">
            <div class="section-title">4. ç–¾ç—…ç±»å‹ï¼ˆå•é€‰ï¼‰</div>
            <select id="diseaseType">
                <option value="0">æ— ç‰¹æ®Šç–¾ç—…/è¥å…»éœ€æ±‚æ­£å¸¸</option>
                <option value="1">æ…¢æ€§ç—…ï¼ˆç³–å°¿ç—…ã€COPDã€æ¶æ€§è‚¿ç˜¤ç­‰ï¼‰</option>
                <option value="2">å¤§æ‰‹æœ¯ã€å’ä¸­ã€é‡ç—‡è‚ºç‚ã€è¡€æ¶²è‚¿ç˜¤</option>
                <option value="3">å¤´éƒ¨æŸä¼¤ã€éª¨é«“ç§»æ¤ã€ICUæ‚£è€…</option>
            </select>
        </div>
        
        <!-- å¹´é¾„ -->
        <div class="section">
            <div class="section-title">5. å¹´é¾„</div>
            <input type="number" id="age" placeholder="è¾“å…¥å¹´é¾„" min="0" max="120">
        </div>
        
        <!-- è®¡ç®—æŒ‰é’® -->
        <button onclick="calculateScore()">ğŸš€ å¼€å§‹è¯„ä¼°è®¡ç®—</button>
        
        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="resultSection" class="result" style="display:none;">
            <div class="section-title">è¯„ä¼°ç»“æœ</div>
            <div id="patientInfo"></div>
            
            <div class="score-display" id="totalScore">æ€»åˆ†ï¼š0</div>
            
            <div id="scoreBreakdown"></div>
            
            <div id="recommendation"></div>
            
            <div id="riskLevel"></div>
            
            <div class="tips" style="margin-top:15px;">
                <strong>æ“ä½œå»ºè®®ï¼š</strong><br>
                1. å¯æˆªå›¾ä¿å­˜ç»“æœ<br>
                2. é«˜é£é™©æ‚£è€…è¯·é€šçŸ¥è¥å…»ç§‘<br>
                3. è®°å½•åœ¨è¯„ä¼°å•ä¸­
            </div>
        </div>
        
        <div style="text-align:center; margin-top:20px; color:#666; font-size:12px;">
            ä»æµåŒ»é™¢è¥å…»ç§‘æ¨èä½¿ç”¨ | è‡ªåŠ¨è®¡ç®—ç‰ˆæœ¬ 1.0
        </div>
    </div>

    <script>
        // å®æ—¶è®¡ç®—ä½“é‡å˜åŒ–
        function updateWeightLoss() {
            const current = parseFloat(document.getElementById('currentWeight').value) || 0;
            const weight3m = parseFloat(document.getElementById('weight3m').value) || 0;
            
            if (current && weight3m && weight3m > current) {
                const lossPercent = ((weight3m - current) / weight3m * 100).toFixed(1);
                document.getElementById('weightLossDisplay').innerHTML = 
                    `ğŸ“‰ è¿‘3ä¸ªæœˆä½“é‡ä¸‹é™ï¼š<span class="percent">${lossPercent}%</span>`;
            } else if (current && weight3m) {
                document.getElementById('weightLossDisplay').innerHTML = 
                    `ğŸ“ˆ ä½“é‡ç¨³å®šæˆ–å¢åŠ `;
            } else {
                document.getElementById('weightLossDisplay').innerHTML = 
                    `â„¹ï¸ è¾“å…¥å†å²ä½“é‡å¯æŸ¥çœ‹ä¸‹é™ç™¾åˆ†æ¯”`;
            }
        }
        
        // ç»‘å®šå®æ—¶è®¡ç®—
        document.getElementById('currentWeight').addEventListener('input', updateWeightLoss);
        document.getElementById('weight3m').addEventListener('input', updateWeightLoss);
        
        // ä¸»è®¡ç®—å‡½æ•°
        function calculateScore() {
            // è·å–å€¼
            const currentWeight = parseFloat(document.getElementById('currentWeight').value);
            const height = parseFloat(document.getElementById('height').value);
            const weight1m = parseFloat(document.getElementById('weight1m').value) || 0;
            const weight2m = parseFloat(document.getElementById('weight2m').value) || 0;
            const weight3m = parseFloat(document.getElementById('weight3m').value) || 0;
            const foodIntake = parseFloat(document.getElementById('foodIntake').value);
            const physicalState = parseInt(document.getElementById('physicalState').value);
            const diseaseType = parseInt(document.getElementById('diseaseType').value);
            const age = parseInt(document.getElementById('age').value);
            
            // 1. è®¡ç®—ä½“é‡ä¸‹é™ç™¾åˆ†æ¯”
            let loss1m = 0, loss2m = 0, loss3m = 0;
            if (weight1m && currentWeight && weight1m > currentWeight) {
                loss1m = ((weight1m - currentWeight) / weight1m * 100);
            }
            if (weight2m && currentWeight && weight2m > currentWeight) {
                loss2m = ((weight2m - currentWeight) / weight2m * 100);
            }
            if (weight3m && currentWeight && weight3m > currentWeight) {
                loss3m = ((weight3m - currentWeight) / weight3m * 100);
            }
            
            // 2. è®¡ç®—BMI
            let bmi = 0;
            if (height && currentWeight) {
                bmi = currentWeight / ((height/100) ** 2);
            }
            
            // 3. è¥å…»çŠ¶å†µè¯„åˆ†
            let nutritionScore = 0;
            
            // è§„åˆ™1ï¼šä½“é‡ä¸‹é™>5%ï¼ˆ3ä¸ªæœˆï¼‰
            if (loss3m > 5 || (foodIntake >= 50 && foodIntake <= 75)) {
                nutritionScore = Math.max(nutritionScore, 1);
            }
            
            // è§„åˆ™2ï¼šä½“é‡ä¸‹é™>5%ï¼ˆ2ä¸ªæœˆï¼‰æˆ– BMI 18.5-20.5ä¸”æœ‰ç—‡çŠ¶ æˆ– è¿›é£Ÿ25-50%
            if (loss2m > 5 || 
                (bmi >= 18.5 && bmi <= 20.5 && physicalState >= 1) || 
                (foodIntake >= 25 && foodIntake < 50)) {
                nutritionScore = Math.max(nutritionScore, 2);
            }
            
            // è§„åˆ™3ï¼šä½“é‡ä¸‹é™>5%ï¼ˆ1ä¸ªæœˆï¼‰æˆ– >15%ï¼ˆ3ä¸ªæœˆï¼‰æˆ– BMI<18.5ä¸”æœ‰ç—‡çŠ¶ æˆ– è¿›é£Ÿ<25%
            if (loss1m > 5 || 
                loss3m > 15 || 
                (bmi > 0 && bmi < 18.5 && physicalState >= 2) || 
                foodIntake < 25) {
                nutritionScore = Math.max(nutritionScore, 3);
            }
            
            // 4. ç–¾ç—…è¯„åˆ†ï¼ˆç›´æ¥æ˜ å°„ï¼‰
            const diseaseScore = diseaseType;
            
            // 5. å¹´é¾„è¯„åˆ†
            const ageScore = age >= 70 ? 1 : 0;
            
            // 6. æ€»åˆ†
            const totalScore = nutritionScore + diseaseScore + ageScore;
            
            // 7. æ˜¾ç¤ºç»“æœ
            document.getElementById('patientInfo').innerHTML = `
                <strong>æ‚£è€…ï¼š</strong>${document.getElementById('patientName').value || 'æœªå¡«å†™'} &nbsp;
                <strong>ç—…å†å·ï¼š</strong>${document.getElementById('patientID').value || 'æœªå¡«å†™'}
            `;
            
            document.getElementById('totalScore').innerHTML = `æ€»åˆ†ï¼š${totalScore} åˆ†`;
            
            document.getElementById('scoreBreakdown').innerHTML = `
                <div><strong>è¯¦ç»†å¾—åˆ†ï¼š</strong></div>
                <div>è¥å…»çŠ¶å†µï¼š${nutritionScore} åˆ†</div>
                <div>ç–¾ç—…ä¸¥é‡ç¨‹åº¦ï¼š${diseaseScore} åˆ†</div>
                <div>å¹´é¾„ï¼š${ageScore} åˆ†</div>
                ${bmi > 0 ? `<div>BMIï¼š${bmi.toFixed(1)}</div>` : ''}
            `;
            
            // é£é™©ç­‰çº§å’Œå»ºè®®
            let riskLevel = "", recommendation = "";
            if (totalScore >= 6) {
                riskLevel = `<span style="color:red;font-weight:bold;">é«˜é£é™©</span>`;
                recommendation = "ğŸ”´ ç«‹å³å¯åŠ¨è¥å…»æ²»ç–—è®¡åˆ’ï¼Œå¿…é¡»é€šçŸ¥è¥å…»ç§‘ä¼šè¯Š";
            } else if (totalScore >= 4) {
                riskLevel = `<span style="color:orange;font-weight:bold;">é«˜é£é™©</span>`;
                recommendation = "ğŸ”´ ç«‹å³å¯åŠ¨è¥å…»æ²»ç–—è®¡åˆ’ï¼Œå¿…é¡»é€šçŸ¥è¥å…»ç§‘ä¼šè¯Š";
            } else if (totalScore >= 3) {
                riskLevel = `<span style="color:#f0ad4e;font-weight:bold;">é«˜é£é™©</span>`;
                recommendation = "ğŸ”´ ç«‹å³å¯åŠ¨è¥å…»æ²»ç–—è®¡åˆ’ï¼Œå¿…é¡»é€šçŸ¥è¥å…»ç§‘ä¼šè¯Š";
            } else {
                riskLevel = `<span style="color:green;font-weight:bold;">ä½é£é™©</span>`;
                recommendation = "âœ… è¥å…»é£é™©è¾ƒä½ï¼Œå¸¸è§„ç›‘æµ‹å³å¯";
            }
            
            document.getElementById('riskLevel').innerHTML = `<strong>é£é™©ç­‰çº§ï¼š</strong>${riskLevel}`;
            document.getElementById('recommendation').innerHTML = `<strong>å¤„ç†å»ºè®®ï¼š</strong>${recommendation}`;
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultSection').style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœ
            document.getElementById('resultSection').scrollIntoView({behavior: 'smooth'});
        }
    </script>
</body>
</html>
